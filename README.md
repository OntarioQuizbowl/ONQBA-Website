# ONQBA Website

The new website of the Ontario Quizbowl Association.

## Dependencies

Gatsby CLI:
```
npm install -g gatsby-cli
```

After cloning this repo, run:
```
npm install
```

## Local Development

To run the local development server:
```
gatsby develop
```

The site runs at `http://localhost:8000`, GraphiQL runs at `http://localhost:8000/___graphql`.

## Deployment

This website is deployed using GitHub pages and the deployment process is unfortunately a bit convoluted right now. It will hopefully be simplified in the future.

In order to deploy the site at the root of the `ontarioquizbowl.github.io` subdomain - instead of at a subpath of my personal subdomain `sherryhli.github.io`, this repository is forked by [OntarioQuizbowl](https://github.com/OntarioQuizbowl) and renamed to `ontarioquizbowl.github.io` there. Developers should clone both [sherryhli/ONQBA-Website](https://github.com/sherryhli/ONQBA-Website) and [OntarioQuizbowl/ontarioquizbowl.github.io](https://github.com/OntarioQuizbowl/ontarioquizbowl.github.io).

> *Important: When developing on this website, all work should be done in [sherryhli/ONQBA-Website](https://github.com/sherryhli/ONQBA-Website). The latest commit in [OntarioQuizbowl](https://github.com/OntarioQuizbowl)'s fork should only contain static pages generated by Gatsby, no source code!*

When the site is ready to be deployed, we first reset [OntarioQuizbowl/ontarioquizbowl.github.io](https://github.com/OntarioQuizbowl/ontarioquizbowl.github.io) to the most recent commit that contains source code. This should correspond to the last deployed commit in [sherryhli/ONQBA-Website](https://github.com/sherryhli/ONQBA-Website).

```
git reset --hard [commit-hash-here]
```

We now sync the fork to the upstream branch:

```
git fetch upstream master
git merge upstream/master
git push -f
```

Now the two repositories are identical.

Run the following in [OntarioQuizbowl/ontarioquizbowl.github.io](https://github.com/OntarioQuizbowl/ontarioquizbowl.github.io):
```
npm run deploy
```

This creates a production build of the site and overwrites [OntarioQuizbowl/ontarioquizbowl.github.io](https://github.com/OntarioQuizbowl/ontarioquizbowl.github.io)'s `master` branch with the contents of the `public` directory. The deploy script also creates a `CNAME` file containing "onqba.ca" inside `public`. GitHub pages automatically deploys the latest changes to https://ontarioquizbowl.github.io, which has the custom domain https://onqba.ca.
